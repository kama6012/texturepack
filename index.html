<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>Download Sample</title>
    </head>
    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.js"></script>
        <script type="text/javascript" src="js/base64.js"></script>
        <script type="text/javascript" src="js/jszip.js"></script>
        <script type="text/javascript" src="js/jszip-utils.js"></script>
      <script type='text/javascript'>
      async function genzip(){
        let zip = new JSZip();
        let skin = fetch('https://crafatar.com/skins/565d64224b444734a22eca9ac6039ceb')
        .then(response => response.blob())
        .then(skin => {
          zip.file("assets/minecraft/textures/skin.png", skin)
        })
        fetch('https://api.github.com/repos/kama6012/texturepack/contents/MyPack/MyPack.zip?ref=main',{
          headers: {
            'authorization': 'token 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',
            "Accept": "application/vnd.github.v3+json"
          }
        })
        .then(response => response.json())
        .then(data => {
          let content = JSON.stringify(data['content'])
          content = content.replace(/\"/g, "").replace(/\\n/g, "");
          zip.loadAsync(content, {base64: true})
          .then(dev => {
            zip.generateAsync({type:"blob"}).then(content => saveAs(content, "example.zip"))
          })
        })
        .catch(error => console.error('通信に失敗しました', error));
      }
      genzip();
      </script>
    </body>
</html>